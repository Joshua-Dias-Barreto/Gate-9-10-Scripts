# GATE 9 Macro - Geometry and Materials Test
# Converted from OpenGATE 10 test007

# =====================================================
# VERBOSE
# =====================================================
/control/verbose 0
/run/verbose 0
/event/verbose 0
/tracking/verbose 0

# =====================================================
# VISUALISATION (disabled)
# =====================================================
/vis/disable

# =====================================================
# GEOMETRY
# =====================================================

# Material database
/gate/geometry/setMaterialDatabase GateMaterials.db

# World
/gate/world/geometry/setXLength 1.5 m
/gate/world/geometry/setYLength 1.5 m
/gate/world/geometry/setZLength 1.5 m
/gate/world/setMaterial Air

# Waterbox - main volume
/gate/world/daughters/name Waterbox
/gate/world/daughters/insert box
/gate/Waterbox/geometry/setXLength 60 cm
/gate/Waterbox/geometry/setYLength 60 cm
/gate/Waterbox/geometry/setZLength 60 cm
/gate/Waterbox/placement/setTranslation 0.0 0.0 35.0 cm
/gate/Waterbox/setMaterial Water
/gate/Waterbox/vis/setColor blue
/gate/Waterbox/vis/setVisible 1

# Sheet - rotated lead box inside Waterbox
/gate/Waterbox/daughters/name Sheet
/gate/Waterbox/daughters/insert box
/gate/Sheet/geometry/setXLength 30 cm
/gate/Sheet/geometry/setYLength 30 cm
/gate/Sheet/geometry/setZLength 2 mm
/gate/Sheet/setMaterial Lead

# Rotation: 33 degrees around X-axis with center at (0, 0, 10 cm)
# The rotation matrix for 33 degrees around X-axis is:
# [1,    0,         0      ]
# [0,  cos(33),  -sin(33) ]
# [0,  sin(33),   cos(33) ]
# Translation calculation includes rotation offset
/gate/Sheet/placement/setRotationAxis 1 0 0
/gate/Sheet/placement/setRotationAngle 33 deg
/gate/Sheet/placement/setTranslation 0.0 -3.06 -10.2 cm
/gate/Sheet/vis/setColor red
/gate/Sheet/vis/setVisible 1

# Mysphere - lung sphere inside Waterbox
/gate/Waterbox/daughters/name mysphere
/gate/Waterbox/daughters/insert sphere
/gate/mysphere/geometry/setRmax 5 cm
/gate/mysphere/placement/setTranslation 0.0 0.0 -8.0 cm
/gate/mysphere/setMaterial Lung
/gate/mysphere/vis/setColor green
/gate/mysphere/vis/setVisible 1

# Mytrap - trapezoid inside Waterbox
/gate/Waterbox/daughters/name mytrap
/gate/Waterbox/daughters/insert trpd
/gate/mytrap/geometry/setX1Length 10 cm
/gate/mytrap/geometry/setY1Length 10 cm
/gate/mytrap/geometry/setX2Length 5 cm
/gate/mytrap/geometry/setY2Length 5 cm
/gate/mytrap/geometry/setZLength 8 cm
/gate/mytrap/geometry/setXBoxPos 0 cm
/gate/mytrap/geometry/setYBoxPos 0 cm
/gate/mytrap/geometry/setZBoxPos 0 cm
/gate/mytrap/placement/setTranslation 0.0 0.0 15.0 cm
/gate/mytrap/setMaterial PMMA
/gate/mytrap/vis/setVisible 1

# =====================================================
# PHYSICS
# =====================================================
/gate/physics/addPhysicsList QGSP_BIC_EMY

# Set production cuts (default)
/gate/physics/Gamma/SetCutInRegion world 1 mm
/gate/physics/Electron/SetCutInRegion world 1 mm
/gate/physics/Positron/SetCutInRegion world 1 mm
/gate/physics/Proton/SetCutInRegion world 1 mm

# =====================================================
# DETECTORS/ACTORS
# =====================================================

# Simulation Statistics Actor
/gate/actor/addActor SimulationStatisticActor Stats
/gate/actor/Stats/saveEveryNSeconds 20
/gate/actor/Stats/save stat007_volumes.txt

# =====================================================
# INITIALISATION
# =====================================================
/gate/run/initialize

# =====================================================
# SOURCE
# =====================================================

/gate/source/addSource Default gps
/gate/source/Default/gps/particle proton
/gate/source/Default/gps/ene/mono 240 MeV

# Circular beam spot with 1cm radius
/gate/source/Default/gps/pos/type Beam
/gate/source/Default/gps/pos/shape Circle
/gate/source/Default/gps/pos/radius 1 cm
/gate/source/Default/gps/pos/centre 0 0 0 cm

# Beam direction along z-axis
/gate/source/Default/gps/direction 0 0 1

# Activity-based source
/gate/source/Default/setActivity 2500 Bq

# =====================================================
# TIMING
# =====================================================

# Single time slice: 0.0 to 0.5 seconds
/gate/application/setTimeStart 0.0 s
/gate/application/setTimeStop 0.5 s

# =====================================================
# START
# =====================================================
/gate/random/setEngineName MersenneTwister
/gate/random/setEngineSeed auto

/gate/application/start