# GATE 9 Macro - Dose Actor Test
# Converted from OpenGATE 10 test008

# =====================================================
# VERBOSE
# =====================================================
/control/verbose 0
/run/verbose 0
/event/verbose 0
/tracking/verbose 0

# =====================================================
# VISUALISATION (disabled)
# =====================================================
#/vis/disable

# =====================================================
# GEOMETRY
# =====================================================

# Material database
/gate/geometry/setMaterialDatabase GateMaterials.db

# World
/gate/world/geometry/setXLength 1.0 m
/gate/world/geometry/setYLength 1.0 m
/gate/world/geometry/setZLength 1.0 m
/gate/world/setMaterial Air

# Fake box - parent volume with translation and rotation
/gate/world/daughters/name fake
/gate/world/daughters/insert box
/gate/fake/geometry/setXLength 40 cm
/gate/fake/geometry/setYLength 40 cm
/gate/fake/geometry/setZLength 40 cm
/gate/fake/placement/setTranslation 1.0 2.0 3.0 cm
/gate/fake/placement/setRotationAxis 1 0 0
/gate/fake/placement/setRotationAngle 10 deg
/gate/fake/setMaterial Air
/gate/fake/vis/setColor magenta
/gate/fake/vis/setVisible 1

# Waterbox - nested inside fake with its own translation and rotation
/gate/fake/daughters/name waterbox
/gate/fake/daughters/insert box
/gate/waterbox/geometry/setXLength 10 cm
/gate/waterbox/geometry/setYLength 10 cm
/gate/waterbox/geometry/setZLength 10 cm
/gate/waterbox/placement/setTranslation -3.0 -2.0 -1.0 cm
/gate/waterbox/placement/setRotationAxis 0 1 0
/gate/waterbox/placement/setRotationAngle 20 deg
/gate/waterbox/setMaterial Water
/gate/waterbox/vis/setColor blue
/gate/waterbox/vis/setVisible 1

# =====================================================
# PHYSICS
# =====================================================
/gate/physics/addPhysicsList QGSP_BERT_EMV

# Production cuts
/gate/physics/Gamma/SetCutInRegion world 700 um
/gate/physics/Electron/SetCutInRegion world 700 um
/gate/physics/Positron/SetCutInRegion world 700 um
/gate/physics/Proton/SetCutInRegion world 700 um


# =====================================================
# ACTORS
# =====================================================

# Dose Actor attached to waterbox
/gate/actor/addActor DoseActor dose
/gate/actor/dose/attachTo waterbox
/gate/actor/dose/stepHitType random
/gate/actor/dose/setResolution 99 99 99
/gate/actor/dose/setVoxelSize 2 2 2 mm
/gate/actor/dose/setPosition 2 3 -2 mm
/gate/actor/dose/enableEdep true
/gate/actor/dose/enableUncertaintyEdep true
/gate/actor/dose/enableSquaredEdep true
/gate/actor/dose/enableDose false
/gate/actor/dose/enableNumberOfHits false
/gate/actor/dose/save test008_dose_actor.mhd
/gate/actor/dose/saveEveryNSeconds 120

# Simulation Statistics Actor
/gate/actor/addActor SimulationStatisticActor Stats
/gate/actor/Stats/save stat008_dose_actor.txt
/gate/actor/Stats/saveEveryNSeconds 120

# =====================================================
# INITIALISATION
# =====================================================
/gate/run/initialize

# =====================================================
# SOURCE
# =====================================================

/gate/source/addSource mysource gps
/gate/source/mysource/gps/particle proton
/gate/source/mysource/gps/ene/mono 150 MeV

# Disc beam position (1 nm radius - essentially a point)
/gate/source/mysource/gps/pos/type Beam
/gate/source/mysource/gps/pos/shape Circle
/gate/source/mysource/gps/pos/radius 1 nm
/gate/source/mysource/gps/pos/centre 0 0 0 cm

# Beam direction along z-axis
/gate/source/mysource/gps/direction 0 0 1

# Activity-based source
/gate/source/mysource/setActivity 50000 Bq

# =====================================================
# TIME SLICES (3 runs of 1/3 second each)
# =====================================================

# Start acquisition with 3 time slices
/gate/application/setTimeStart 0.0 s
/gate/application/setTimeSlice 0.333333 s
/gate/application/setTimeStop 1.0 s

# =====================================================
# START
# =====================================================
/gate/random/setEngineName MersenneTwister
/gate/random/setEngineSeed 12345678

/gate/application/start